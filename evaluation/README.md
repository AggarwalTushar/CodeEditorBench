# Evaluation

## Install

1. Download the Docker image:
    ```
    docker pull xliudg/code_editor_bench:latest
    ```
2. Create and enter the container:
    ```
    docker run -d \
        -v /path/to/your/downloaded/git/evaluation/judge:/home/judge \
        --name judge code_editor_bench
    docker exec -it judge /bin/bash
    ```

## Perform Evaluation

Please evaluate the code in the container.

1. Add a template for codes. Store codes generated by LLMs in the following format:

    ```
    solution_root
    │
    ├── code_debug
    │   ├── model_name1.jsonl
    │   ├── model_name2.jsonl
    │   └── ...
    │
    ├── code_polishment
    │   ├── model_name1.jsonl
    │   ├── model_name2.jsonl
    │   └── ...
    │
    ├── code_switch
    │   ├── model_name1.jsonl
    │   ├── model_name2.jsonl
    │   └── ...
    │
    └── code_translate
        ├── model_name1.jsonl
        ├── model_name2.jsonl
        └── ...
    ```

    Each line of each solution jsonl file should contain the following fields:

    ```
    { 
      "problem_id": Integer representing the problem,
      "completion_id": Integer representing the index of the solution generated by a specific model of the problem, starting from 0,
      "language": Language of the code,
      "code": Code content of the solution
    }
    ```

    Execute:
    ```
    cd /home/judge/scripts
    python3 add_template.py
    ```

    Output is located at: `/home/judge/solution_folder/processed_solution`

2. Submit the model's solutions to the database:
    ```
    python3 submit_solution.py
    ```

3. Start judging:
   
    Run inside the Docker container:
    ```
    nohup bash run_judge.sh > runlog.out 2>&1 &
    ```

    Enter the MySQL database inside Docker:
    ```
    bash mysql.sh
    ```

    Query the models whose solutions have been submitted:
    ```
    select model_id,model_name from models where model_id>48;
    ```

    Set the result of the solutions to be judged:
    ```
    UPDATE solution so
    join (
    select s.solution_id,s.result
    from solution s
    join models m on s.model_id=m.model_id
    where model_name='your_model_name_here'
    ) AS subquery ON so.solution_id = subquery.solution_id
    SET so.result = 0;
    ```

5. Enter the MySQL database inside Docker and check judging status:
   
    Query the count of unsolved problems. If the count is 0, judging is complete:
    ```
    select count(*)
    from solution s
    join problem p
    on s.problem_id=p.problem_id
    where result<4 or result=14;
    ```

6. Measure the runtime of source code for Code Polish problems on the machine:
    ```
    python3 measure_polish_source_code.py
    ```

    After executing the above command, update the time limit for Code Polish problems in the database:
    ```
    python3 update_polish_lmt.py
    ```

7. Compute metrics:
    ```
    python3 compute_metrics.py
    ```
